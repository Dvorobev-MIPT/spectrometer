# Spectrometer

## Описание

**Spectrometer** — приложение для работы с камерой во время анализа спектров на базе Raspberry Pi.  
Позволяет получать изображение с камеры, настраивать параметры съёмки (яркость, контраст, экспозиция и др.), визуализировать и сохранять спектральные данные.  

Интерфейс реализован на PyQt5 и оптимизирован для работы с камерой Raspberry Pi (поддержка picamera2 и libcamera).  
Spectrometer подходит для учебных, лабораторных и исследовательских задач, связанных с анализом света и спектров.

Программа также позволяет точно перемещать линзы и камеру по оптической скамье с шагом 1 мм и погрешностью не более 5%, что удобно для экспериментов и юстировки оптической системы.

---

## Запуск

### Вариант 1. Сборка исполняемого файла

1. Перейдите в папку `./spectrometer/spectrometer_app/` и выполните установку:
   ```bash
   sudo pip install .
   ```
   или, если не работает:
   ```bash
   sudo python3 setup.py install
   ```
2. Перейдите в папку `./programm/spectrometer/`, сделайте скрипт исполняемым и соберите приложение:
   ```bash
   chmod +x build.sh
   ./build.sh
   ```
3. Готовый исполняемый файл появится в папке `./programm/spectrometer/`. Для запуска используйте файл `spectrometer`.

### Вариант 2. Запуск через main.py

1. Перейдите в папку `./spectrometer/spectrometer_app/` и выполните установку:
   ```bash
   sudo pip install .
   ```
   или:
   ```bash
   sudo python3 setup.py install
   ```
2. Запустите файл `main.py` любым удобным способом.

---

## Архитектура программы

Программа разделена на три основных модуля:

- **core**  
  Отвечает за взаимодействие с камерой через интерфейсы `picamera2` (вывод изображения) и `libcamera2` (настройка камеры). Также содержит интерфейсы управления перемещением оптических элементов.

- **ai**  
  Реализует пользовательский интерфейс (UI) программы, включая все элементы управления и визуализацию данных.

- **utils**  
  Содержит вспомогательные утилиты и функции для обработки данных, работы с файлами и другие служебные компоненты.

Описание компонентов каждого модуля представлено в следующей структуре:

![alt text](https://github.com/Dvorobev-MIPT/spectrometer/blob/main/images/spectrometer_structure.png)

---

## Возможные проблемы и их решения

### Нет изображения с камеры

Проверьте подключение камеры к Raspberry Pi и перезапустите устройство.

### Программа вылетает при первом запуске

Эта проблема возникает чаще всего при первом запуске собранного приложения. В дальнейшем будет устраена полностью. На данный момент для ее решения достаточно попробовать запустить программу повторно

### Выдержка слетает после снимка

Эта проблема будет устранена в итоговом продукте. Сейчас необходимо устанавливать значение повторно, если это требуется.

### Выдержка установлена на N-е значение, но снимок делается при страндартной выдержке (в режиме vnc)

Эта проблема является следствием высокой нагрузки raspberry pi в режиме vnc трансляции. Вероятно, процесс установки значения не добавляется в очередь процессов ОС из за низкой частоты обработки системой обновлений программы. Лучшее да и наверное единственное решение - нажимать enter несколько раз.

## Советы по использованию 

1. Проверяйте, что в настройках стоят значения по умолчанию. Если необходимо проводите сброс параметров.
2. Не устанавливайте слишком низкую выдержку. Экспериментально, было установлена, что камера raspberry pi в режиме видео различает выдержки (0.01-0.03) с. Поэтому настоятельно не рекомендуется устанавливать данные значения. Для снятия спектра в хорошо затемненных условиях требуются значения в несколько раз больше. А низкая выдержка в режиме видео может сделать невидимой для камеры картину спектра.
3. Не рекомедуется без необходимости изменять настройки камеры (не считая выдержки и фокуса).
4. Не рекомедуется ставить фокус на очень большие значения. (возможно будет скорректировано в будущих обновлениях установки и ПО). 
5. При работе в режиме vnc трансляции лучше устанавливать качество изображения таким, чтобы были различимы цвета. Так же рекомендуется разрешение не ниже 1280x720. В качестве vnc так же рекомендуется использовать Tiger vnc, поскольку она показывает наилучшую производительность и стабильность. Рекомедуемый режим H.264 при полной цветовой палитре. Сжатие не требуется. 